var Utils=require("./utils"),internals={delimiter:"&",depth:5,arrayLimit:20,parametersLimit:1e3};internals.parseValues=function(e,t){t="string"==typeof t?t:internals.delimiter;for(var n={},i=e.split(t,internals.parametersLimit),r=0,a=i.length;a>r;++r){var s=i[r],o=-1===s.indexOf("]=")?s.indexOf("="):s.indexOf("]=")+1;if(-1===o)n[Utils.decode(s)]="";else{var l=Utils.decode(s.slice(0,o)),c=Utils.decode(s.slice(o+1));n[l]=n[l]?[].concat(n[l]).concat(c):c}}return n},internals.parseObject=function(e,t){if(!e.length)return t;var n=e.shift(),i={};if("[]"===n)i=[],i=i.concat(internals.parseObject(e,t));else{var r="["===n[0]&&"]"===n[n.length-1]?n.slice(1,n.length-1):n,a=parseInt(r,10);!isNaN(a)&&n!==r&&internals.arrayLimit>=a?(i=[],i[a]=internals.parseObject(e,t)):i[r]=internals.parseObject(e,t)}return i},internals.parseKeys=function(e,t,n){if(e){var i=/^([^\[\]]*)/,r=/(\[[^\[\]]*\])/g,a=i.exec(e);if(!Object.prototype.hasOwnProperty(a[1])){var s=[];a[1]&&s.push(a[1]);for(var o=0;null!==(a=r.exec(e))&&n>o;)++o,Object.prototype.hasOwnProperty(a[1].replace(/\[|\]/g,""))||s.push(a[1]);return a&&s.push("["+e.slice(a.index)+"]"),internals.parseObject(s,t)}}},module.exports=function(e,t,n){if(""===e||null===e||e===void 0)return{};"number"!=typeof t&&(n=t,t=internals.depth);var i="string"==typeof e?internals.parseValues(e,n):Utils.clone(e),r={};for(var a in i)if(i.hasOwnProperty(a)){var s=internals.parseKeys(a,i[a],t);r=Utils.merge(r,s)}return Utils.compact(r)};