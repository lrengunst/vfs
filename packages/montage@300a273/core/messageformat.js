(function(t){function e(t,n){var a;if(t&&n&&(e.locale[t]=n),a=t=t||"en",n=n||e.locale[a=e.Utils.getFallbackLocale(t)],!n)throw Error("Plural Function not found for locale: "+t);this.pluralFunc=n,this.locale=t,this.fallbackLocale=a}e.locale={en:function(t){return 1===t?"one":"other"}},e.SafeString=function(t){this.string=t},e.SafeString.prototype.toString=function(){return""+this.string},e.Utils={numSub:function(t,e,n){return t.replace(/^#|[^\\]#/g,function(t){var a=t&&2===t.length?t.charAt(0):"";return a+'" + (function(){ var x = '+e+';\nif( isNaN(x) ){\nthrow new Error("MessageFormat: `"+lastkey_'+n+'+"` isnt a number.");\n}\nreturn x;\n})() + "'})},escapeExpression:function(t){var n={"\n":"\\n",'"':'\\"'},a=/[\n"]/g,i=/[\n"]/,r=function(t){return n[t]||"&amp;"};return t instanceof e.SafeString?""+t:null===t||t===!1?"":i.test(t)?t.replace(a,r):t},getFallbackLocale:function(t){for(var n=t.indexOf("-")>=0?"-":"_";!e.locale.hasOwnProperty(t);)if(t=t.substring(0,t.lastIndexOf(n)),0===t.length)return null;return t}};var n=function(){var t={parse:function(t,e){function n(t,e,n){for(var a=t,i=n-t.length,r=0;i>r;r++)a=e+a;return a}function a(t){var e=t.charCodeAt(0);if(255>=e)var a="x",i=2;else var a="u",i=4;return"\\"+a+n(e.toString(16).toUpperCase(),"0",i)}function i(t){return'"'+t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/[\x80-\uFFFF]/g,a)+'"'}function r(t){B>P||(P>B&&(B=P,k=[]),k.push(t))}function s(){var t="start@"+P,e=D[t];if(e)return P=e.nextPos,e.result;var n=P,a=o(),i=null!==a?function(t){return{type:"program",program:t}}(a):null;if(null!==i)var r=i;else{var r=null;P=n}return D[t]={nextPos:P,result:r},r}function o(){var t="messageFormatPattern@"+P,e=D[t];if(e)return P=e.nextPos,e.result;var n=P,a=P,i=L();if(null!==i){for(var r=[],s=l();null!==s;){r.push(s);var s=l()}if(null!==r)var o=[i,r];else{var o=null;P=a}}else{var o=null;P=a}var c=null!==o?function(t,e){var n=[];t&&t.val&&n.push(t);for(var a in e)e.hasOwnProperty(a)&&n.push(e[a]);return{type:"messageFormatPattern",statements:n}}(o[0],o[1]):null;if(null!==c)var h=c;else{var h=null;P=n}return D[t]={nextPos:P,result:h},h}function l(){var e="messageFormatPatternRight@"+P,n=D[e];if(n)return P=n.nextPos,n.result;var a=P,i=P;if("{"===t.substr(P,1)){var s="{";P+=1}else{var s=null;T&&r('"{"')}if(null!==s){var o=x();if(null!==o){var l=c();if(null!==l){var h=x();if(null!==h){if("}"===t.substr(P,1)){var u="}";P+=1}else{var u=null;T&&r('"}"')}if(null!==u){var d=L();if(null!==d)var p=[s,o,l,h,u,d];else{var p=null;P=i}}else{var p=null;P=i}}else{var p=null;P=i}}else{var p=null;P=i}}else{var p=null;P=i}}else{var p=null;P=i}var g=null!==p?function(t,e){var n=[];return t&&n.push(t),e&&e.val&&n.push(e),{type:"messageFormatPatternRight",statements:n}}(p[2],p[5]):null;if(null!==g)var m=g;else{var m=null;P=a}return D[e]={nextPos:P,result:m},m}function c(){var e="messageFormatElement@"+P,n=D[e];if(n)return P=n.nextPos,n.result;var a=P,i=P,s=M();if(null!==s){var o=P;if(","===t.substr(P,1)){var l=",";P+=1}else{var l=null;T&&r('","')}if(null!==l){var c=h();if(null!==c)var u=[l,c];else{var u=null;P=o}}else{var u=null;P=o}var d=null!==u?u:"";if(null!==d)var p=[s,d];else{var p=null;P=i}}else{var p=null;P=i}var g=null!==p?function(t,e){var n={type:"messageFormatElement",argumentIndex:t};return e&&e.length?n.elementFormat=e[1]:n.output=!0,n}(p[0],p[1]):null;if(null!==g)var m=g;else{var m=null;P=a}return D[e]={nextPos:P,result:m},m}function h(){var e="elementFormat@"+P,n=D[e];if(n)return P=n.nextPos,n.result;var a=P,i=P,s=x();if(null!==s){if("plural"===t.substr(P,6)){var o="plural";P+=6}else{var o=null;T&&r('"plural"')}if(null!==o){var l=x();if(null!==l){if(","===t.substr(P,1)){var c=",";P+=1}else{var c=null;T&&r('","')}if(null!==c){var h=x();if(null!==h){var p=u();if(null!==p){var g=x();if(null!==g)var m=[s,o,l,c,h,p,g];else{var m=null;P=i}}else{var m=null;P=i}}else{var m=null;P=i}}else{var m=null;P=i}}else{var m=null;P=i}}else{var m=null;P=i}}else{var m=null;P=i}var v=null!==m?function(t,e){return{type:"elementFormat",key:t,val:e.val}}(m[1],m[5]):null;if(null!==v)var f=v;else{var f=null;P=a}if(null!==f)var L=f;else{var M=P,y=P,C=x();if(null!==C){if("select"===t.substr(P,6)){var w="select";P+=6}else{var w=null;T&&r('"select"')}if(null!==w){var b=x();if(null!==b){if(","===t.substr(P,1)){var _=",";P+=1}else{var _=null;T&&r('","')}if(null!==_){var z=x();if(null!==z){var E=d();if(null!==E){var S=x();if(null!==S)var B=[C,w,b,_,z,E,S];else{var B=null;P=y}}else{var B=null;P=y}}else{var B=null;P=y}}else{var B=null;P=y}}else{var B=null;P=y}}else{var B=null;P=y}}else{var B=null;P=y}var k=null!==B?function(t,e){return{type:"elementFormat",key:t,val:e.val}}(B[1],B[5]):null;if(null!==k)var O=k;else{var O=null;P=M}if(null!==O)var L=O;else var L=null}return D[e]={nextPos:P,result:L},L}function u(){var t="pluralStyle@"+P,e=D[t];if(e)return P=e.nextPos,e.result;var n=P,a=p(),i=null!==a?function(t){return{type:"pluralStyle",val:t}}(a):null;if(null!==i)var r=i;else{var r=null;P=n}return D[t]={nextPos:P,result:r},r}function d(){var t="selectStyle@"+P,e=D[t];if(e)return P=e.nextPos,e.result;var n=P,a=m(),i=null!==a?function(t){return{type:"selectStyle",val:t}}(a):null;if(null!==i)var r=i;else{var r=null;P=n}return D[t]={nextPos:P,result:r},r}function p(){var t="pluralFormatPattern@"+P,e=D[t];if(e)return P=e.nextPos,e.result;var n=P,a=P,i=g(),r=null!==i?i:"";if(null!==r){for(var s=[],o=v();null!==o;){s.push(o);var o=v()}if(null!==s)var l=[r,s];else{var l=null;P=a}}else{var l=null;P=a}var c=null!==l?function(t,e){var n={type:"pluralFormatPattern",pluralForms:e};return n.offset=t?t:0,n}(l[0],l[1]):null;if(null!==c)var h=c;else{var h=null;P=n}return D[t]={nextPos:P,result:h},h}function g(){var e="offsetPattern@"+P,n=D[e];if(n)return P=n.nextPos,n.result;var a=P,i=P,s=x();if(null!==s){if("offset"===t.substr(P,6)){var o="offset";P+=6}else{var o=null;T&&r('"offset"')}if(null!==o){var l=x();if(null!==l){if(":"===t.substr(P,1)){var c=":";P+=1}else{var c=null;T&&r('":"')}if(null!==c){var h=x();if(null!==h){var u=w();if(null!==u){var d=x();if(null!==d)var p=[s,o,l,c,h,u,d];else{var p=null;P=i}}else{var p=null;P=i}}else{var p=null;P=i}}else{var p=null;P=i}}else{var p=null;P=i}}else{var p=null;P=i}}else{var p=null;P=i}var g=null!==p?function(t){return t}(p[5]):null;if(null!==g)var m=g;else{var m=null;P=a}return D[e]={nextPos:P,result:m},m}function m(){var t="selectFormatPattern@"+P,e=D[t];if(e)return P=e.nextPos,e.result;for(var n=P,a=[],i=v();null!==i;){a.push(i);var i=v()}var r=null!==a?function(t){return{type:"selectFormatPattern",pluralForms:t}}(a):null;if(null!==r)var s=r;else{var s=null;P=n}return D[t]={nextPos:P,result:s},s}function v(){var e="pluralForms@"+P,n=D[e];if(n)return P=n.nextPos,n.result;var a=P,i=P,s=x();if(null!==s){var l=f();if(null!==l){var c=x();if(null!==c){if("{"===t.substr(P,1)){var h="{";P+=1}else{var h=null;T&&r('"{"')}if(null!==h){var u=x();if(null!==u){var d=o();if(null!==d){var p=x();if(null!==p){if("}"===t.substr(P,1)){var g="}";P+=1}else{var g=null;T&&r('"}"')}if(null!==g)var m=[s,l,c,h,u,d,p,g];else{var m=null;P=i}}else{var m=null;P=i}}else{var m=null;P=i}}else{var m=null;P=i}}else{var m=null;P=i}}else{var m=null;P=i}}else{var m=null;P=i}}else{var m=null;P=i}var v=null!==m?function(t,e){return{type:"pluralForms",key:t,val:e}}(m[1],m[5]):null;if(null!==v)var L=v;else{var L=null;P=a}return D[e]={nextPos:P,result:L},L}function f(){var e="stringKey@"+P,n=D[e];if(n)return P=n.nextPos,n.result;var a=P,i=M(),s=null!==i?function(t){return t}(i):null;if(null!==s)var o=s;else{var o=null;P=a}if(null!==o)var l=o;else{var c=P,h=P;if("="===t.substr(P,1)){var u="=";P+=1}else{var u=null;T&&r('"="')}if(null!==u){var d=w();if(null!==d)var p=[u,d];else{var p=null;P=h}}else{var p=null;P=h}var g=null!==p?function(t){return t}(p[1]):null;if(null!==g)var m=g;else{var m=null;P=c}if(null!==m)var l=m;else var l=null}return D[e]={nextPos:P,result:l},l}function L(){var t="string@"+P,e=D[t];if(e)return P=e.nextPos,e.result;var n=P,a=P,i=x();if(null!==i){var r=[],s=P,o=x();if(null!==o){var l=y();if(null!==l){var c=x();if(null!==c)var h=[o,l,c];else{var h=null;P=s}}else{var h=null;P=s}}else{var h=null;P=s}for(;null!==h;){r.push(h);var s=P,o=x();if(null!==o){var l=y();if(null!==l){var c=x();if(null!==c)var h=[o,l,c];else{var h=null;P=s}}else{var h=null;P=s}}else{var h=null;P=s}}if(null!==r)var u=[i,r];else{var u=null;P=a}}else{var u=null;P=a}var d=null!==u?function(t,e){for(var n=[],a=0;e.length>a;++a)for(var i=0;e[a].length>i;++i)n.push(e[a][i]);return{type:"string",val:t+n.join("")}}(u[0],u[1]):null;if(null!==d)var p=d;else{var p=null;P=n}return D[t]={nextPos:P,result:p},p}function M(){var e="id@"+P,n=D[e];if(n)return P=n.nextPos,n.result;var a=P,i=P,s=x();if(null!==s){if(null!==t.substr(P).match(/^[a-zA-Z$_]/)){var o=t.charAt(P);P++}else{var o=null;T&&r("[a-zA-Z$_]")}if(null!==o){var l=[];if(null!==t.substr(P).match(/^[^ 	\n\r,.+={}]/)){var c=t.charAt(P);P++}else{var c=null;T&&r("[^ 	\\n\\r,.+={}]")}for(;null!==c;)if(l.push(c),null!==t.substr(P).match(/^[^ 	\n\r,.+={}]/)){var c=t.charAt(P);P++}else{var c=null;T&&r("[^ 	\\n\\r,.+={}]")}if(null!==l){var h=x();if(null!==h)var u=[s,o,l,h];else{var u=null;P=i}}else{var u=null;P=i}}else{var u=null;P=i}}else{var u=null;P=i}var d=null!==u?function(t,e){return t+(e?e.join(""):"")}(u[1],u[2]):null;if(null!==d)var p=d;else{var p=null;P=a}return D[e]={nextPos:P,result:p},p}function y(){var t="chars@"+P,e=D[t];if(e)return P=e.nextPos,e.result;var n=P,a=C();if(null!==a)for(var i=[];null!==a;){i.push(a);var a=C()}else var i=null;var r=null!==i?function(t){return t.join("")}(i):null;if(null!==r)var s=r;else{var s=null;P=n}return D[t]={nextPos:P,result:s},s}function C(){var e="char@"+P,n=D[e];if(n)return P=n.nextPos,n.result;var a=P;if(null!==t.substr(P).match(/^[^{}\\\0- 	\n\r]/)){var i=t.charAt(P);P++}else{var i=null;T&&r("[^{}\\\\\\0- 	\\n\\r]")}var s=null!==i?function(t){return t}(i):null;if(null!==s)var o=s;else{var o=null;P=a}if(null!==o)var l=o;else{var c=P;if("\\#"===t.substr(P,2)){var h="\\#";P+=2}else{var h=null;T&&r('"\\\\#"')}var u=null!==h?function(){return"\\#"}():null;if(null!==u)var d=u;else{var d=null;P=c}if(null!==d)var l=d;else{var p=P;if("\\{"===t.substr(P,2)){var g="\\{";P+=2}else{var g=null;T&&r('"\\\\{"')}var m=null!==g?function(){return"{"}():null;if(null!==m)var v=m;else{var v=null;P=p}if(null!==v)var l=v;else{var f=P;if("\\}"===t.substr(P,2)){var L="\\}";P+=2}else{var L=null;T&&r('"\\\\}"')}var M=null!==L?function(){return"}"}():null;if(null!==M)var y=M;else{var y=null;P=f}if(null!==y)var l=y;else{var C=P,w=P;if("\\u"===t.substr(P,2)){var x="\\u";P+=2}else{var x=null;T&&r('"\\\\u"')}if(null!==x){var _=b();if(null!==_){var z=b();if(null!==z){var E=b();if(null!==E){var S=b();if(null!==S)var B=[x,_,z,E,S];else{var B=null;P=w}}else{var B=null;P=w}}else{var B=null;P=w}}else{var B=null;P=w}}else{var B=null;P=w}var k=null!==B?function(t,e,n,a){return String.fromCharCode(parseInt("0x"+t+e+n+a))}(B[1],B[2],B[3],B[4]):null;if(null!==k)var O=k;else{var O=null;P=C}if(null!==O)var l=O;else var l=null}}}}return D[e]={nextPos:P,result:l},l}function w(){var e="digits@"+P,n=D[e];if(n)return P=n.nextPos,n.result;var a=P;if(null!==t.substr(P).match(/^[0-9]/)){var i=t.charAt(P);P++}else{var i=null;T&&r("[0-9]")}if(null!==i)for(var s=[];null!==i;)if(s.push(i),null!==t.substr(P).match(/^[0-9]/)){var i=t.charAt(P);P++}else{var i=null;T&&r("[0-9]")}else var s=null;var o=null!==s?function(t){return parseInt(t.join(""),10)}(s):null;if(null!==o)var l=o;else{var l=null;P=a}return D[e]={nextPos:P,result:l},l}function b(){var e="hexDigit@"+P,n=D[e];if(n)return P=n.nextPos,n.result;if(null!==t.substr(P).match(/^[0-9a-fA-F]/)){var a=t.charAt(P);P++}else{var a=null;T&&r("[0-9a-fA-F]")}return D[e]={nextPos:P,result:a},a}function x(){var t="_@"+P,e=D[t];if(e)return P=e.nextPos,e.result;var n=T;T=!1;for(var a=P,i=[],s=_();null!==s;){i.push(s);var s=_()}var o=null!==i?function(t){return t.join("")}(i):null;if(null!==o)var l=o;else{var l=null;P=a}return T=n,T&&null===l&&r("whitespace"),D[t]={nextPos:P,result:l},l}function _(){var e="whitespace@"+P,n=D[e];if(n)return P=n.nextPos,n.result;if(null!==t.substr(P).match(/^[ 	\n\r]/)){var a=t.charAt(P);P++}else{var a=null;T&&r("[ 	\\n\\r]")}return D[e]={nextPos:P,result:a},a}function z(){function e(t){t.sort();for(var e=null,n=[],a=0;t.length>a;a++)t[a]!==e&&(n.push(t[a]),e=t[a]);switch(n.length){case 0:return"end of input";case 1:return n[0];default:return n.slice(0,n.length-1).join(", ")+" or "+n[n.length-1]}}var n=e(k),a=Math.max(P,B),r=t.length>a?i(t.charAt(a)):"end of input";return"Expected "+n+" but "+r+" found."}function E(){for(var e=1,n=1,a=!1,i=0;B>i;i++){var r=t.charAt(i);"\n"===r?(a||e++,n=1,a=!1):"\r"===r|"\u2028"===r||"\u2029"===r?(e++,n=1,a=!0):(n++,a=!1)}return{line:e,column:n}}var S={_:x,"char":C,chars:y,digits:w,elementFormat:h,hexDigit:b,id:M,messageFormatElement:c,messageFormatPattern:o,messageFormatPatternRight:l,offsetPattern:g,pluralFormatPattern:p,pluralForms:v,pluralStyle:u,selectFormatPattern:m,selectStyle:d,start:s,string:L,stringKey:f,whitespace:_};if(void 0!==e){if(void 0===S[e])throw Error("Invalid rule name: "+i(e)+".")}else e="start";var P=0,T=!0,B=0,k=[],D={},O=S[e]();if(null===O||P!==t.length){var A=E();throw new this.SyntaxError(z(),A.line,A.column)}return O},toSource:function(){return this._source}};return t.SyntaxError=function(t,e,n){this.name="SyntaxError",this.message=t,this.line=e,this.column=n},t.SyntaxError.prototype=Error.prototype,t}();e.prototype.parse=function(){return n.parse.apply(n,arguments)},e.prototype.precompile=function(t){function n(t,s){s=s||{};var o,l,c,h="";switch(t.type){case"program":return n(t.program);case"messageFormatPattern":for(o=0;t.statements.length>o;++o)h+=n(t.statements[o],s);return r.begin+h+r.end;case"messageFormatPatternRight":for(o=0;t.statements.length>o;++o)h+=n(t.statements[o],s);return h;case"messageFormatElement":return s.pf_count=s.pf_count||0,h+='if(!d){\nthrow new Error("MessageFormat: No data passed to function.");\n}\n',t.output?h+='r += d["'+t.argumentIndex+'"];\n':(c="lastkey_"+(s.pf_count+1),h+="var "+c+' = "'+t.argumentIndex+'";\n',h+="var k_"+(s.pf_count+1)+"=d["+c+"];\n",h+=n(t.elementFormat,s)),h;case"elementFormat":return"select"===t.key?(h+=n(t.val,s),h+="r += (pf_"+s.pf_count+"[ k_"+(s.pf_count+1)+" ] || pf_"+s.pf_count+'[ "other" ])( d );\n'):"plural"===t.key&&(h+=n(t.val,s),h+="if ( pf_"+s.pf_count+"[ k_"+(s.pf_count+1)+' + "" ] ) {\n',h+="r += pf_"+s.pf_count+"[ k_"+(s.pf_count+1)+' + "" ]( d ); \n',h+="}\nelse {\n",h+="r += (pf_"+s.pf_count+'[ MessageFormat.locale["'+a.fallbackLocale+'"]( k_'+(s.pf_count+1)+" - off_"+s.pf_count+" ) ] || pf_"+s.pf_count+'[ "other" ] )( d );\n',h+="}\n"),h;case"pluralFormatPattern":for(s.pf_count=s.pf_count||0,h+="var off_"+s.pf_count+" = "+t.offset+";\n",h+="var pf_"+s.pf_count+" = { \n",i=!0,o=0;t.pluralForms.length>o;++o)"other"===t.pluralForms[o].key&&(i=!1),l?h+=",\n":l=1,h+='"'+t.pluralForms[o].key+'" : '+n(t.pluralForms[o].val,function(){var t=JSON.parse(JSON.stringify(s));return t.pf_count++,t}());if(h+="\n};\n",i)throw Error("No 'other' form found in pluralFormatPattern "+s.pf_count);return h;case"selectFormatPattern":for(s.pf_count=s.pf_count||0,h+="var off_"+s.pf_count+" = 0;\n",h+="var pf_"+s.pf_count+" = { \n",i=!0,o=0;t.pluralForms.length>o;++o)"other"===t.pluralForms[o].key&&(i=!1),l?h+=",\n":l=1,h+='"'+t.pluralForms[o].key+'" : '+n(t.pluralForms[o].val,function(){var t=JSON.parse(JSON.stringify(s));return t.pf_count++,t}());if(h+="\n};\n",i)throw Error("No 'other' form found in selectFormatPattern "+s.pf_count);return h;case"string":return'r += "'+e.Utils.numSub(e.Utils.escapeExpression(t.val),"k_"+s.pf_count+" - off_"+(s.pf_count-1),s.pf_count)+'";\n';default:throw Error("Bad AST type: "+t.type)}}var a=this,i=!1,r={begin:'function(d){\nvar r = "";\n',end:"return r;\n}"};return n(t)},e.prototype.compile=function(t){return Function("MessageFormat","return "+this.precompile(this.parse(t)))(e)},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=e),exports.MessageFormat=e):"function"==typeof define&&define.amd?define(function(){return e}):t.MessageFormat=e})(this);